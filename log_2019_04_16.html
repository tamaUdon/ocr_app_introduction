<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Introduction: original OCR app</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/marx/2.0.4/marx.css">
    <link rel="stylesheet" type="text/css" href="http://alexgorbatchev.com/pub/sh/current/styles/shCoreEclipse.css"/>
    <script type="text/javascript" src="http://alexgorbatchev.com/pub/sh/current/scripts/shCore.js"></script>
    <script type="text/javascript" src="http://alexgorbatchev.com/pub/sh/current/scripts/shBrushPython.js"></script>
    <script type="text/javascript">SyntaxHighlighter.all();</script>
</head>

<body>
<main>
    <br>
        <hr>
        <h4>2019/04/16</h4>
        <p>"i" の認識に苦しんでいる。作業が停滞しているので先にAPIに投げる機能を実装していこうと思う。<br>
            <br>
            一文字ずつ矩形を認識していって、前後の矩形の中点のxの値が重なっていれば "i" か "j" だと判断して、<br>
            二つの矩形を連結する関数を書きたかったのだが、うまくいかなかった。<br>
            
    </p>
    <pre class="brush:py">
    def _get_integrate_rectangle(corners_list): #corners_list->矩形の頂点リスト
        x_region = []
        del_pt = []
        for i,r in enumerate(corners_list):
            index, x, y, w, h, lower_left_y, right_corner = list(r) 
            x_region.append([x+w/2, x, w, y, h, lower_left_y])
            
            #1つ前の中点とx軸がかさなっていればつなぐ
            layer = [i-1 for p in range(x, x+w+1) if i > 0 and p == x_region[i-1][0]]
            
            if i > 0 and layer:
                del_pt.extend(layer)
                x = max(x_region[i-1][1], x)
                w = max(x_region[i-1][2], w)
                right_corner = x+w
                y = min(x_region[i-1][3], y)
                lower_left_y = max(x_region[i-1][5], lower_left_y)
                h = lower_left_y - y
                y2 = round(lower_left_y / 10) * 10 # 検出領域左下のY座標を揃える
                index = y2 * im_w  + x
                
        #重なっている一つ前の矩形をcorners_listから全削除
        for d in (reversed(del_pt)):
            del corners_list[d]
        
        return corners
    </pre>
    <br>
    <p>
    9行目のリスト内包表記で矩形の重なりを検出したかったのだが、どうもうまく取得できていないようだ。<br>
        システムがやや肥大化してきて、デバッグ作業が大変だ。<br>
        ユニットテストというのがあるらしく、書いてみてもいいかもしれない。<br>
    </p>
    <a href="log_index.html"><button>戻る</button></a>
</main>
</body>
</html>